
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../diagnostics/">
      
      
        <link rel="next" href="../overview/">
      
      
        
      
      
      <link rel="icon" href="../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Export - Coppafisher Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pciseq" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Coppafisher Documentation" class="md-header__button md-logo" aria-label="Coppafisher Documentation" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Coppafisher Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Export
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/paulshuker/coppafisher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Coppafisher
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Getting started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../basic_usage/" class="md-tabs__link">
          
  
  
  Usage

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../diagnostics/" class="md-tabs__link">
        
  
  
    
  
  Diagnostics

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Export

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../overview/" class="md-tabs__link">
          
  
  
  Method

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../troubleshoot/" class="md-tabs__link">
        
  
  
    
  
  Troubleshoot

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../migration/" class="md-tabs__link">
        
  
  
    
  
  Migration

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Coppafisher Documentation" class="md-nav__button md-logo" aria-label="Coppafisher Documentation" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    Coppafisher Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/paulshuker/coppafisher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Coppafisher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../diagnostics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diagnostics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Export
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Export
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pciseq" class="md-nav__link">
    <span class="md-ellipsis">
      
        PciSeq
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PciSeq">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dapi-image-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        DAPI image export
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DAPI image export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtered-dapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtered DAPI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unfiltered-dapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unfiltered DAPI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gene-spots-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gene spots export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-cell-mask-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Merge cell mask chunks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Images
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-the-additional-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extract the additional image(s)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stitch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stitch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dapi-register" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dapi Register
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-dapi-register" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-Dapi Register
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Method
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Method
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../find_spots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Find Spots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stitch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stitch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../register/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../call_spots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Call Spots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../omp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OMP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshoot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshoot
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pciseq" class="md-nav__link">
    <span class="md-ellipsis">
      
        PciSeq
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PciSeq">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dapi-image-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        DAPI image export
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DAPI image export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtered-dapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtered DAPI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unfiltered-dapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unfiltered DAPI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gene-spots-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gene spots export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-cell-mask-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Merge cell mask chunks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Images
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-the-additional-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extract the additional image(s)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stitch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stitch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dapi-register" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dapi Register
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-dapi-register" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-Dapi Register
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Export</h1>

<h2 id="pciseq">PciSeq</h2>
<p>For probabilistic cell typing with <a href="https://github.com/acycliq/pciSeq">pciSeq</a>, a DAPI background image and gene spot
positions must be exported.</p>
<h3 id="dapi-image-export">DAPI image export</h3>
<h4 id="filtered-dapi">Filtered DAPI</h4>
<p>To export the anchor's filtered DAPI stitched image</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">export_pciseq_dapi_image</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">export_pciseq_dapi_image</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
</code></pre></div>
<p>The DAPI image can then be loaded into memory by</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">dapi_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/path/to/dapi_image.npz&quot;</span><span class="p">)[</span><span class="s2">&quot;arr_0&quot;</span><span class="p">]</span>
</code></pre></div>
<h4 id="unfiltered-dapi">Unfiltered DAPI</h4>
<p>To export the anchor's unfiltered DAPI stitched image</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">export_pciseq_unfiltered_dapi_image</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">config_path</span> <span class="o">=</span> <span class="s2">&quot;/path/to/config.ini&quot;</span>
<span class="n">export_pciseq_unfiltered_dapi_image</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">radius_norm_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<p>You can set <code>radius_norm_file="default"</code> to use the default dapi radius normalisation when the dapi channel is 0.</p>
<p>The DAPI image can then be loaded into memory by</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">dapi_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/path/to/dapi_image.npz&quot;</span><span class="p">)[</span><span class="s2">&quot;arr_0&quot;</span><span class="p">]</span>
</code></pre></div>
<h3 id="gene-spots-export">Gene spots export</h3>
<p>Export gene spots into a compatible csv file by</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">export_to_pciseq</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">export_to_pciseq</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</code></pre></div>
<p>where method can be <code>"omp"</code>, <code>"prob"</code>, or <code>"anchor"</code> for each gene calling method. To set a score and/or intensity
minimum threshold:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">export_to_pciseq</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">export_to_pciseq</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">score_thresh</span><span class="p">,</span> <span class="n">intensity_thresh</span><span class="p">)</span>
</code></pre></div>
<p>score_thresh and intensity_thresh must be numbers. Use the <a href="../diagnostics/#viewer">Viewer</a> to help decide on thresholds.
intensity_thresh is set to <code>0.15</code> for OMP in the Viewer by default.</p>
<h3 id="merge-cell-mask-chunks">Merge cell mask chunks</h3>
<p>Multiple cell masks for separate tiles can be merged together that are produced by cellpose. The cell masks must be
uint16 3d images all of the same shape <code>(im_z, im_y, im_x)</code>. They must be saved as .npy files.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">merge_cell_masks</span>

<span class="n">merged_cell_mask</span> <span class="o">=</span> <span class="n">merge_cell_masks</span><span class="p">(</span>
    <span class="n">cell_mask_file_paths</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/path/to/cell_mask_0.npy&quot;</span><span class="p">,</span> <span class="s2">&quot;/path/to/cell_mask_1.npy&quot;</span><span class="p">],</span>
    <span class="n">cell_mask_origin_yxzs</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1100</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]],</span>
    <span class="n">expected_tile_overlap</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
    <span class="n">merge_cells_method</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>where <code>cell_mask_origin_yxzs</code> is the bottom-leftmost position for each cell mask in a global coordinate frame. For more
details, see the <code>merge_cell_masks</code> docstring at <code>coppafisher/results/cell_mask.py</code>.</p>
<p>If you have a coppafisher notebook, you can base the merging off the tile stitch results:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">merge_cell_masks</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">merged_cell_mask</span> <span class="o">=</span> <span class="n">merge_cell_masks</span><span class="p">(</span>
    <span class="n">cell_mask_file_paths</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/path/to/cell_mask_0.npy&quot;</span><span class="p">,</span> <span class="s2">&quot;/path/to/cell_mask_1.npy&quot;</span><span class="p">],</span>
    <span class="n">cell_mask_origin_yxzs</span><span class="o">=</span><span class="n">nb</span><span class="o">.</span><span class="n">stitch</span><span class="o">.</span><span class="n">tile_origin</span><span class="p">,</span>
    <span class="n">expected_tile_overlap</span><span class="o">=</span><span class="n">nb</span><span class="o">.</span><span class="n">stitch</span><span class="o">.</span><span class="n">associated_config</span><span class="p">[</span><span class="s2">&quot;stitch&quot;</span><span class="p">][</span><span class="s2">&quot;expected_overlap&quot;</span><span class="p">],</span>
    <span class="n">merge_cells_method</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<details class="info">
<summary>Merging methods</summary>
<p>There are two strategies for merging cell masks together:</p>
<p>1) <code class="highlight"><span class="n">merge_cells_method</span><span class="o">=</span><span class="s2">&quot;&quot;</span></code> does no cell merging and the tile that has the closest tile centre to the overlapping
pixel data is used. This can leave erroneous split cells at the midpoint between the tile overlap.</p>
<p><figure markdown="span">
  <img alt="Image title" src="../images/cell_mask/no_merge.png" width="600" />
  <figcaption>No merging result.</figcaption>
</figure></p>
<p>2) <code class="highlight"><span class="n">merge_cells_method</span><span class="o">=</span><span class="s2">&quot;merge 0.5&quot;</span></code> merges cells together in the overlapping region when the cells have at
least 50% overlap. You can adjust the number 0.5 for anything between 0 and 1 to best suit your data. For more
details on the merging method:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.results</span><span class="w"> </span><span class="kn">import</span> <span class="n">merge_cell_masks</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merge_cell_masks</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</code></pre></div>
<p><figure markdown="span">
  <img alt="Image title" src="../images/cell_mask/merge_all.png" width="600" />
  <figcaption>Merging with a low overlap threshold.</figcaption>
</figure></p>
<p><figure markdown="span">
  <img alt="Image title" src="../images/cell_mask/merge_strict.png" width="600" />
  <figcaption>Merging with a high overlap threshold.</figcaption>
</figure></p>
</details>
<details class="tip">
<summary>Saving the merged cell mask</summary>
<p>You can save the resulting merged cell mask as a .npy file</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/path/to/merged_cell_mask.npy&quot;</span><span class="p">,</span> <span class="n">merged_cell_mask</span><span class="p">)</span>
</code></pre></div>
<p>Or a compressed .npz file</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="s2">&quot;/path/to/merged_cell_mask.npy&quot;</span><span class="p">,</span> <span class="n">merged_cell_mask</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="custom-images">Custom Images</h2>
<p>Additional custom images can be aligned with coppafisher images and gene spots provided that you have a dapi channel (or
something similar to align with the anchor-DAPI image).</p>
<h3 id="extract-the-additional-images">Extract the additional image(s)</h3>
<p>The additional images must be extracted from ND2 files. You will likely require the DAPI channel for best results. They
are saved as tiff files. If you do not have ND2 input files, you need to first manually convert them to tiff files.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.custom_alignment</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_raw</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Notebook</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="s2">&quot;/path/to/used/config.ini&quot;</span>
<span class="n">custom_nd2</span> <span class="o">=</span> <span class="s2">&quot;/path/to/input/file.nd2&quot;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;/path/to/extract/directory/&quot;</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s2">&quot;/path/to/notebook&quot;</span><span class="p">)</span>
<span class="n">extract_raw</span><span class="p">(</span>
    <span class="n">nb</span><span class="p">,</span>
    <span class="n">config_file</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">read_dir</span><span class="o">=</span><span class="n">custom_nd2</span><span class="p">,</span>
    <span class="n">use_tiles</span><span class="o">=</span><span class="n">nb</span><span class="o">.</span><span class="n">basic_info</span><span class="o">.</span><span class="n">use_tiles</span><span class="p">,</span>
    <span class="n">use_channels</span><span class="o">=</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">basic_info</span><span class="o">.</span><span class="n">dapi_channel</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
    <span class="n">reverse_custom_z</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">radius_norm_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">radius_norm_channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dapi_radius_norm_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><code>use_channels</code> can be any valid channel(s) inside the custom image .nd2 file. This will also extract the anchor round in
the DAPI channel. You can reverse the z planes in the custom image by setting <code>reverse_custom_z</code> to <code class="highlight"><span class="kc">True</span></code>.</p>
<p>Set <code class="highlight"><span class="n">radius_norm_file</span><span class="o">=</span><span class="s2">&quot;default_nine&quot;</span></code> to use the default nine channel tile radius/channel normalisation file
at
<a href="https://github.com/paulshuker/coppafisher/blob/HEAD/coppafisher/setup/nine_channel_normalisations.npz"><code>coppafisher/setup/nine_channel_normalisations.npz</code></a>.</p>
<p>Set <code class="highlight"><span class="n">radius_norm_file</span><span class="o">=</span><span class="s2">&quot;default_seven&quot;</span></code> to use the default seven channel tile radius/channel normalisation file
at
<a href="https://github.com/paulshuker/coppafisher/blob/HEAD/coppafisher/setup/seven_channel_normalisations.npz"><code>coppafisher/setup/seven_channel_normalisations.npz</code></a>.</p>
<p>Set <code class="highlight"><span class="n">dapi_radius_norm_file</span><span class="o">=</span><span class="s2">&quot;default&quot;</span></code> to use the default dapi channel tile radius/channel normalisation file at
<a href="https://github.com/paulshuker/coppafisher/blob/HEAD/coppafisher/setup/dapi_channel_normalisations.npz"><code>coppafisher/setup/dapi_channel_normalisations.npz</code></a>.</p>
<details class="note">
<summary>Config File</summary>
<p>The config file must be a valid configuration, like the one used during the experiment. <code>input_dir</code> must be a real
input directory.</p>
</details>
<h3 id="stitch">Stitch</h3>
<p>The extracted raw anchor-DAPI images are stitched using coppafisher's <a href="../stitch/">stitch</a> method. The custom image is
stitched by the same method separately. This then needs to be registered with the anchor-DAPI in the next step. Do this
for each custom image channel separately. I suggest starting with the dapi channels first</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.custom_alignment</span><span class="w"> </span><span class="kn">import</span> <span class="n">fuse_custom_and_dapi</span>

<span class="n">fused_custom_dapi_image</span><span class="p">,</span> <span class="n">fused_anchor_dapi_image</span> <span class="o">=</span> <span class="n">fuse_custom_and_dapi</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">nb</span><span class="o">.</span><span class="n">basic_info</span><span class="o">.</span><span class="n">dapi_channel</span><span class="p">)</span>
</code></pre></div>
<h3 id="dapi-register">Dapi Register</h3>
<p>Alignment is done using the package <a href="https://pypi.org/project/LineStuffUp/"><code>LineStuffUp</code></a> maintained by Max Shinn
(m.shinn@ucl.ac.uk). This allows control over the type of transformation to apply based on their custom images. Install
via pip</p>
<div class="highlight"><pre><span></span><code>python -m pip install LineStuffUp
</code></pre></div>
<p>Then start the interactive alignment process</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">linestuffup.gui</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">linestuffup.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">TranslateRotate</span>

<span class="n">round_transform</span> <span class="o">=</span> <span class="n">linestuffup</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">alignment_gui</span><span class="p">(</span>
    <span class="n">fused_custom_dapi_image</span><span class="p">,</span> <span class="n">fused_anchor_dapi_image</span><span class="p">,</span> <span class="n">transform_type</span><span class="o">=</span><span class="n">TranslateRotate</span>
<span class="p">)</span>
</code></pre></div>
<p>Press <code>Add new point</code> and click twice to place two corresponding points. Do this a few times, preferably in various z
planes too. Press <code>Perform transform</code> to see the resulting transform. Once you are happy with the result, close the
napari window.</p>
<details class="info">
<summary>Type of Transform</summary>
<p>You can change the type of transform you wish to find, please see the transfrom
<a href="https://github.com/mwshinn/LineStuffUp/blob/master/README.md">readme</a> for details.</p>
<p>For example, you could use the more robust transform type of <code class="highlight"><span class="n">TranslateRotateRescale</span></code>. It requires four
points in every corner of the image on both edges of the z stack for best results.</p>
</details>
<details class="tip">
<summary>Save and Load Transforms</summary>
<p>Every transform can be saved and reloaded at a later point. You just need to save the text representation of the
transform which can be found by</p>
<div class="highlight"><pre><span></span><code><span class="nb">str</span><span class="p">(</span><span class="n">round_transform</span><span class="p">)</span>
</code></pre></div>
<p>You can save it using Python</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/saved/transform.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">round_transform</span><span class="p">))</span>
</code></pre></div>
<p>It can be reloaded by</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">linestuffup.base</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/saved/transform.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;round_transform = &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
</code></pre></div>
<p>You can rename the variable from <code>round_transform</code> to anything.</p>
<p>Do not run <code class="highlight"><span class="n">exec</span></code> on stranger's code (it could be malicious)!</p>
</details>
<p>You can now apply the resulting transform to the custom dapi image and save the result as a <code>.tif</code> file</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tifffile</span>

<span class="n">fused_custom_dapi_image_transformed</span> <span class="o">=</span> <span class="n">round_transform</span><span class="o">.</span><span class="n">transform_image</span><span class="p">(</span>
    <span class="n">fused_custom_dapi_image</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="n">fused_anchor_dapi_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">force_size</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">tifffile</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;/path/to/saved/custom_dapi_image_transformed.tif&quot;</span><span class="p">,</span> <span class="n">fused_custom_dapi_image_transformed</span><span class="p">)</span>
<span class="k">del</span> <span class="n">fused_custom_dapi_image_transformed</span>
<span class="k">del</span> <span class="n">fused_anchor_dapi_image</span>
</code></pre></div>
<h3 id="non-dapi-register">Non-Dapi Register</h3>
<p>For a non-dapi custom image channel <code>c</code>, it is recommended to find a specific transform to move to the dapi channel for
best registration. To do this, first find a transform to move into the dapi custom image's frame</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">coppafisher.custom_alignment</span><span class="w"> </span><span class="kn">import</span> <span class="n">fuse_custom_and_dapi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">linestuffup.gui</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">linestuffup.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">TranslateRotate</span>

<span class="n">fused_custom_channel_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fuse_custom_and_dapi</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

<span class="n">channel_transform</span> <span class="o">=</span> <span class="n">linestuffup</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">alignment_gui</span><span class="p">(</span>
    <span class="n">fused_custom_channel_image</span><span class="p">,</span> <span class="n">fused_custom_dapi_image</span><span class="p">,</span> <span class="n">transform_type</span><span class="o">=</span><span class="n">TranslateRotate</span>
<span class="p">)</span>
</code></pre></div>
<p>Now save the fully registered channel image</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">tifffile</span>

<span class="n">fused_custom_channel_image_transformed</span> <span class="o">=</span> <span class="p">(</span><span class="n">channel_transform</span> <span class="o">+</span> <span class="n">round_transform</span><span class="p">)</span><span class="o">.</span><span class="n">transform_image</span><span class="p">(</span>
    <span class="n">fused_custom_channel_image</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="n">fused_custom_channel_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">force_size</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">tifffile</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/path/to/saved/custom_channel_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">_image_transformed.tif&quot;</span><span class="p">,</span> <span class="n">fused_custom_channel_image_transformed</span><span class="p">)</span>
<span class="k">del</span> <span class="n">fused_custom_channel_image_transformed</span>
<span class="k">del</span> <span class="n">fused_custom_channel_image</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>